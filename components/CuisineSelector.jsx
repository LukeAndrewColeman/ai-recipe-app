'use client';

import { useRouter } from 'next/navigation';
import { useState, useEffect } from 'react';
import LoadingOverlay from './LoadingOverlay';
import { motion } from 'motion/react';
export default function CuisineSelector() {
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);
  const [mounted, setMounted] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');

  const cuisineCategories = {
    'Asian Cuisine': [
      { name: 'chinese', icon: 'ðŸ¥¢' },
      { name: 'japanese', icon: 'ðŸ±' },
      { name: 'thai', icon: 'ðŸœ' },
      { name: 'korean', icon: 'ðŸš' },
      { name: 'vietnamese', icon: 'ðŸ²' },
      { name: 'indian', icon: 'ðŸ›' },
      { name: 'malaysian', icon: 'ðŸœ' },
      { name: 'indonesian', icon: 'ðŸš' },
      { name: 'filipino', icon: 'ðŸ¥˜' },
      { name: 'mongolian', icon: 'ðŸ–' },
      { name: 'nepalese', icon: 'ðŸ¥˜' },
      { name: 'sri-lankan', icon: 'ðŸ›' },
    ],
    'European Cuisine': [
      { name: 'italian', icon: 'ðŸ' },
      { name: 'french', icon: 'ðŸ¥–' },
      { name: 'english', icon: 'ðŸ´' },
      { name: 'greek', icon: 'ðŸ¥™' },
      { name: 'spanish', icon: 'ðŸ¥˜' },
      { name: 'german', icon: 'ðŸ¥¨' },
      { name: 'portuguese', icon: 'ðŸŸ' },
      { name: 'polish', icon: 'ðŸ¥Ÿ' },
      { name: 'hungarian', icon: 'ðŸ²' },
      { name: 'turkish', icon: 'ðŸ¥™' },
      { name: 'russian', icon: 'ðŸ¥˜' },
      { name: 'scandinavian', icon: 'ðŸŸ' },
    ],
    'American Cuisine': [
      { name: 'american', icon: 'ðŸ”' },
      { name: 'mexican', icon: 'ðŸŒ®' },
      { name: 'bbq', icon: 'ðŸ–' },
      { name: 'cajun', icon: 'ðŸ¦' },
      { name: 'soul-food', icon: 'ðŸ—' },
      { name: 'brazilian', icon: 'ðŸ¥©' },
      { name: 'peruvian', icon: 'ðŸŸ' },
      { name: 'argentinian', icon: 'ðŸ¥©' },
      { name: 'colombian', icon: 'ðŸ«“' },
      { name: 'cuban', icon: 'ðŸ¥ª' },
    ],
    'Regional Specialties': [
      { name: 'dim-sum', icon: 'ðŸ¥Ÿ' },
      { name: 'street-food', icon: 'ðŸ¥¡' },
      { name: 'tapas', icon: 'ðŸ¤' },
      { name: 'sushi', icon: 'ðŸ£' },
      { name: 'pizza', icon: 'ðŸ•' },
    ],
    'Other Cuisines': [
      { name: 'mediterranean', icon: 'ðŸ«’' },
      { name: 'middle-eastern', icon: 'ðŸ§†' },
      { name: 'caribbean', icon: 'ðŸ›' },
      { name: 'african', icon: 'ðŸ¥˜' },
      { name: 'fusion', icon: 'ðŸ½ï¸' },
      { name: 'vegetarian', icon: 'ðŸ¥—' },
      { name: 'seafood', icon: 'ðŸ¦ž' },
      { name: 'desserts', icon: 'ðŸ°' },
    ],
  };

  useEffect(() => {
    setMounted(true);
  }, []);

  const handleCuisineClick = async (cuisine) => {
    if (!cuisine) {
      console.error('Invalid cuisine selected');
      return;
    }

    try {
      setIsLoading(true);
      const formattedCuisine = cuisine.toLowerCase().trim();
      router.push(`/cuisines/${formattedCuisine}`);
    } catch (error) {
      console.error('Error navigating to cuisine page:', error);
      setIsLoading(false);
    }
  };

  const filteredCategories = searchTerm
    ? Object.fromEntries(
        Object.entries(cuisineCategories).map(([category, cuisines]) => [
          category,
          cuisines.filter((cuisine) =>
            cuisine.name.toLowerCase().includes(searchTerm.toLowerCase())
          ),
        ])
      )
    : cuisineCategories;

  if (!mounted) return null;

  return (
    <div className='relative space-y-6 container mx-auto pb-20 pt-10 px-6'>
      <div className='mb-8'>
        <h1 className='text-4xl font-bold mb-3'>
          Generate Recipes from Your Favorite Cuisines
        </h1>
        <h2 className='text-neutral/70'>
          Select a cuisine to discover authentic recipes and cooking inspiration
          generated by AI.
        </h2>
      </div>
      {isLoading && <LoadingOverlay />}
      {/* Cuisine Categories */}
      {Object.entries(filteredCategories).map(
        ([category, cuisines]) =>
          cuisines.length > 0 && (
            <motion.div
              key={category}
              className='space-y-4'
              initial={{ opacity: 0, y: 50 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.5 }}
            >
              <h3 className='text-lg font-semibold text-gray-700'>
                {category}
              </h3>
              <div className='flex flex-wrap gap-3'>
                {cuisines.map((cuisine) => (
                  <motion.div
                    key={cuisine.name}
                    whileHover={{ scale: 1.05, rotate: 2, origin: 'center' }}
                  >
                    <button
                      key={cuisine.name}
                      onClick={() => handleCuisineClick(cuisine.name || '')}
                      disabled={isLoading || !cuisine.name}
                      className='btn bg-secondary/20 border border-secondary/40 hover:border-secondary hover:bg-secondary/40 text-neutral normal-case flex items-center justify-start gap-2 px-4 transition-all'
                    >
                      <span className='text-xl'>{cuisine.icon}</span>
                      <span className='capitalize'>{cuisine.name}</span>
                    </button>
                  </motion.div>
                ))}
              </div>
            </motion.div>
          )
      )}
    </div>
  );
}
